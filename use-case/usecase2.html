<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">

<title>Faire une carte avec les DROM rapproch√©s gr√¢ce √† cartiflette ‚Äì Documentation projet cartiflette üßÄ</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.scss">
<link rel="stylesheet" href="../styles-dark.scss">
<link rel="stylesheet" href="../site_libs/quarto-contrib/quarto-project/quarto-ext/fontawesome/assets/css/all.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Documentation projet cartiflette üßÄ</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../use-case/index.html"> 
<span class="menu-text">Galerie d‚Äôexemples</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/inseefrlab/cartiflette">
            Le projet sur Github
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pr√©liminaire-r√©cup√©ration-des-cheptels-fran√ßais" id="toc-pr√©liminaire-r√©cup√©ration-des-cheptels-fran√ßais" class="nav-link active" data-scroll-target="#pr√©liminaire-r√©cup√©ration-des-cheptels-fran√ßais"><span class="header-section-number">1</span> Pr√©liminaire: r√©cup√©ration des cheptels fran√ßais</a></li>
  <li><a href="#r√©cup√©rer-les-contours-modifi√©s-via-cartiflette" id="toc-r√©cup√©rer-les-contours-modifi√©s-via-cartiflette" class="nav-link" data-scroll-target="#r√©cup√©rer-les-contours-modifi√©s-via-cartiflette"><span class="header-section-number">2</span> R√©cup√©rer les contours modifi√©s via <code>cartiflette</code></a>
  <ul class="collapse">
  <li><a href="#la-r√©cup√©ration-des-donn√©es-utilisant-cartiflette" id="toc-la-r√©cup√©ration-des-donn√©es-utilisant-cartiflette" class="nav-link" data-scroll-target="#la-r√©cup√©ration-des-donn√©es-utilisant-cartiflette"><span class="header-section-number">2.1</span> La r√©cup√©ration des donn√©es utilisant <code>cartiflette</code></a></li>
  <li><a href="#association-du-fonds-de-carte-cartiflette-au-jeu-de-donn√©es-initial" id="toc-association-du-fonds-de-carte-cartiflette-au-jeu-de-donn√©es-initial" class="nav-link" data-scroll-target="#association-du-fonds-de-carte-cartiflette-au-jeu-de-donn√©es-initial"><span class="header-section-number">2.2</span> Association du fonds de carte <code>cartiflette</code> au jeu de donn√©es initial</a></li>
  <li><a href="#production-de-la-carte-interactive" id="toc-production-de-la-carte-interactive" class="nav-link" data-scroll-target="#production-de-la-carte-interactive"><span class="header-section-number">2.3</span> Production de la carte interactive</a></li>
  </ul></li>
  <li><a href="#comment-faire-sans-cartiflette" id="toc-comment-faire-sans-cartiflette" class="nav-link" data-scroll-target="#comment-faire-sans-cartiflette"><span class="header-section-number">3</span> Comment faire sans <code>cartiflette</code> ?</a></li>
  <li><a href="#bilan" id="toc-bilan" class="nav-link" data-scroll-target="#bilan"><span class="header-section-number">4</span> Bilan</a>
  <ul class="collapse">
  <li><a href="#volume-de-donn√©es-t√©l√©charg√©es" id="toc-volume-de-donn√©es-t√©l√©charg√©es" class="nav-link" data-scroll-target="#volume-de-donn√©es-t√©l√©charg√©es"><span class="header-section-number">4.1</span> Volume de donn√©es t√©l√©charg√©es</a></li>
  <li><a href="#nombre-de-lignes-de-code" id="toc-nombre-de-lignes-de-code" class="nav-link" data-scroll-target="#nombre-de-lignes-de-code"><span class="header-section-number">4.2</span> Nombre de lignes de code</a></li>
  <li><a href="#temps-de-traitement" id="toc-temps-de-traitement" class="nav-link" data-scroll-target="#temps-de-traitement"><span class="header-section-number">4.3</span> Temps de traitement</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="usecase2.ipynb" download="usecase2.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Faire une carte avec les DROM rapproch√©s gr√¢ce √† cartiflette</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lino Galiana </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Cette page est un <em>work in progress</em>! Des exemples dans d‚Äôautres langages que <code>Python</code> <i class="fa-brands fa-python" aria-label="python"></i> viendront ult√©rieurement.</p>
<p>Cette page fait partie d‚Äôune s√©rie de tutoriels illustrant les fonctionnalit√©s de <code>cartiflette</code>. Pour retrouver la liste de ceux-ci, c‚Äôest <a href="../use-case/index.html">ici</a></p>
</div>
</div>
</div>
<p>Ce tutoriel vise √† illustrer un cas d‚Äôusage classique de <code>cartiflette</code> : <strong>r√©cup√©rer de mani√®re flexible un fonds de carte dont les <span class="yellow">DROM sont rapproch√©s</span> et o√π on voit <span class="yellow">un zoom sur l‚ÄôIle de France</span></strong>.</p>
<p>Ce besoin classique est illustr√© en r√©pliquant la carte faite par <a href="https://www.youtube.com/watch?v=mK7Hr2x895k">Jules Grandin pour son podcast ‚ÄúLa Minute Cartographique‚Äù</a> L‚Äôobjectif final de ce tutoriel est de faire cette carte:</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="21" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 20;"><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>carte_interactive_js<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="27" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 26;"><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>viewof beteview <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">radio</span>(</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="bu">Map</span>([[<span class="st">"Vaches üêÆ"</span><span class="op">,</span> <span class="st">"Bovins"</span>]<span class="op">,</span> [<span class="st">"Cochons üê∑"</span><span class="op">,</span> <span class="st">"Porcins"</span>]<span class="op">,</span> [<span class="st">"Moutons üêë"</span><span class="op">,</span> <span class="st">"Ovins"</span>]])<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">"Bovins"</span>}</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    viewof bete</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="37" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 36;"><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>carte_interactive_js <span class="op">=</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div class="bouton-cheptel"&gt;</span><span class="sc">${</span>viewof beteview<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div class="titre-carte-cheptel"&gt;&lt;h3&gt;</span><span class="sc">${</span>title_chosen<span class="sc">}</span><span class="vs">&lt;/h3&gt;&lt;/div&gt;</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div class="carte-cheptel"&gt;</span><span class="sc">${</span><span class="fu">produceMap</span>(cheptel<span class="op">,</span> bete)<span class="sc">}</span><span class="vs">&lt;div&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<details>
<summary>
Voir l‚Äô√©pisode en question de ‚ÄúLa Minute Cartographique‚Äù
</summary>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/mK7Hr2x895k?si=6nNRsJziuUjGsP5B" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</details>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pourquoi utiliser cartiflette pour ce type de besoins ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Beaucoup <span class="yellow">moins de ligne de code</span> √† √©crire :
<ul>
<li>R√©duit le temps n√©cessaire avant d‚Äôobtenir une carte exploratoire, ce qui permet de se concentrer sur la construction de celle-ci plut√¥t que les √©tapes ant√©rieures</li>
<li>R√©duit la difficult√© √† mettre √† jour le code ;</li>
</ul></li>
<li><span class="yellow">Moins de bande passante</span> et d‚Äôespace disque utilis√© car seule la donn√©e n√©cessaire est t√©l√©charg√©e ;</li>
<li><span class="yellow">Moindre besoin d‚Äôexpertise en SIG</span> car la librairie fournit un <code>GeoDataFrame</code> pr√™t √† l‚Äôemploi ce qui ne n√©cessite pas une connaissance pointue dans le domaine (syst√®me de projection, format <em>shapefile</em>, etc.) ;</li>
<li><span class="yellow">Moins de risque d‚Äôerreur</span> que lorsqu‚Äôon fait soi-m√™me la combinaison de sources √† des niveaux administratifs diff√©rents (accoler le masque des arrondissements √† celui des communes limitrophes n√©cessite beaucoup de pr√©cautions) ;</li>
<li><span class="yellow">B√©n√©ficier de m√©tadonn√©es suppl√©mentaires</span> sur les communes que les fonds de carte <code>AdminExpress</code></li>
</ul>
</div>
</div>
</div>
<section id="pr√©liminaire-r√©cup√©ration-des-cheptels-fran√ßais" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Pr√©liminaire: r√©cup√©ration des cheptels fran√ßais</h1>
<p>La vid√©o de Jules Grandin √©voque une ouverture et pr√©paration des donn√©es dans Excel üò±. N√©anmois, en quelques lignes de code, on peut render ces donn√©es propres √† l‚Äôanalyse statistique et cartographique avec <code>Python</code> <i class="fa-brands fa-python" aria-label="python"></i> üòå</p>
<div id="9bf7db53" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Pr√©paration des donn√©es avec Pandas</summary>
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_cheptel():</span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>    url_cheptel <span class="op">=</span> <span class="st">"https://www.insee.fr/fr/statistiques/fichier/2012795/TCRD_073.xlsx"</span></span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-6" class="code-annotation-target"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a>    cheptel2022 <span class="op">=</span> pd.read_excel(url_cheptel, header<span class="op">=</span><span class="dv">3</span>, na_values<span class="op">=</span><span class="st">"nd"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-7" class="code-annotation-target"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a>    type_cheptel <span class="op">=</span> cheptel2022.columns[<span class="op">~</span>cheptel2022.columns.<span class="bu">str</span>.startswith(<span class="st">"Unnamed"</span>)]</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-8" class="code-annotation-target"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a>    cheptel2022.loc[:, type_cheptel] <span class="op">=</span> cheptel2022.loc[:, type_cheptel].mul(<span class="dv">1000</span>)</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>    cheptel2022 <span class="op">=</span> cheptel2022.rename(</span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="annotated-cell-4-11"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Unnamed: 0"</span>: <span class="st">"code"</span>,</span>
<span id="annotated-cell-4-12"><a href="#annotated-cell-4-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Unnamed: 1"</span>: <span class="st">"departement"</span>,</span>
<span id="annotated-cell-4-13"><a href="#annotated-cell-4-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Volailles gallus"</span>: <span class="st">"Volailles"</span>,</span>
<span id="annotated-cell-4-14"><a href="#annotated-cell-4-14" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="annotated-cell-4-15"><a href="#annotated-cell-4-15" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="st">"columns"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4">4</button><span id="annotated-cell-4-16" class="code-annotation-target"><a href="#annotated-cell-4-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-4-17"><a href="#annotated-cell-4-17" aria-hidden="true" tabindex="-1"></a>    type_cheptel <span class="op">=</span> type_cheptel.<span class="bu">str</span>.replace(<span class="st">" gallus"</span>, <span class="st">""</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="5">5</button><span id="annotated-cell-4-18" class="code-annotation-target"><a href="#annotated-cell-4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cheptel2022, type_cheptel</span>
<span id="annotated-cell-4-19"><a href="#annotated-cell-4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-20"><a href="#annotated-cell-4-20" aria-hidden="true" tabindex="-1"></a>cheptel <span class="op">=</span> import_cheptel()</span>
<span id="annotated-cell-4-21"><a href="#annotated-cell-4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-22"><a href="#annotated-cell-4-22" aria-hidden="true" tabindex="-1"></a>cheptel[<span class="dv">0</span>].head(<span class="dv">4</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="6" data-code-annotation="1">Les premi√®res lignes sont de la documentation, les donn√©es ne commencent r√©ellement que ligne 4</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="7" data-code-annotation="2">Extraction du type de b√™tes, cela sera plus utile ult√©rieurement</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="8" data-code-annotation="3">Les donn√©es sont en milliers de t√™te, on ajuste pour pouvoir comparer √† la population</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="16" data-code-annotation="4">La ligne correspondant aux noms de variable n‚Äôest pas compl√®te dans le Excel. Il faut donc retravailler les noms de colonnes.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="18" data-code-annotation="5">On renvoie la donn√©e et la liste des b√™tes</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">departement</th>
<th data-quarto-table-cell-role="th">Bovins</th>
<th data-quarto-table-cell-role="th">Porcins</th>
<th data-quarto-table-cell-role="th">Ovins</th>
<th data-quarto-table-cell-role="th">Caprins</th>
<th data-quarto-table-cell-role="th">Volailles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01</td>
<td>Ain</td>
<td>159900.0</td>
<td>134100.0</td>
<td>21900.0</td>
<td>7200.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>02</td>
<td>Aisne</td>
<td>180400.0</td>
<td>48700.0</td>
<td>29100.0</td>
<td>800.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>03</td>
<td>Allier</td>
<td>495900.0</td>
<td>88000.0</td>
<td>147100.0</td>
<td>9100.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>04</td>
<td>Alpes-de-Haute-Provence</td>
<td>14500.0</td>
<td>2500.0</td>
<td>193800.0</td>
<td>8600.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>En ce qui concerne la population, qui nous servira au d√©nominateur de notre indicateur, nous allons utiliser la variable fournie dans les donn√©es r√©cup√©r√©es par le biais de <code>cartiflette</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
</section>
<section id="r√©cup√©rer-les-contours-modifi√©s-via-cartiflette" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> R√©cup√©rer les contours modifi√©s via <code>cartiflette</code></h1>
<section id="la-r√©cup√©ration-des-donn√©es-utilisant-cartiflette" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="la-r√©cup√©ration-des-donn√©es-utilisant-cartiflette"><span class="header-section-number">2.1</span> La r√©cup√©ration des donn√©es utilisant <code>cartiflette</code></h2>
<p>Notre objectif est de faire une carte aux caract√©ristiques suivantes:</p>
<ul>
<li>Les DROM sont rapproch√©s de la France hexagonale en √©tant plac√©s sous celle-ci ;</li>
<li>Un cartogramme zoom√© de la petite couronne parisienne (d√©partements de la Seine, Hauts-de-Seine, Seine-Saint-Denis et Val de Marne) est disponible en haut √† gauche de celle-ci.</li>
</ul>
<p>Construire soi-m√™me ce fonds de carte est fastidieux, comme l‚Äôillustre la partie <a href="#sans-cartiflette">Comment faire sans cartiflette</a>. Avec <code>cartiflette</code>, ce fonds de carte est pr√©construit √† partir des d√©coupages officiels de l‚ÄôIGN. Il suffit de remplace le niveau <code>FRANCE_ENTIERE</code> en <code>FRANCE_ENTIERE_DROM_RAPPROCHES</code> dans l‚Äôappel √† <code>carti_download</code>.</p>
<div id="lst-cartiflette-example" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-cartiflette-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Example d‚Äôutilisation de cartiflette
</figcaption>
<div aria-describedby="lst-cartiflette-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="3ec649dd" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> cartiflette <span class="im">import</span> carti_download</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>departements <span class="op">=</span> carti_download(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    values<span class="op">=</span><span class="st">"France"</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    crs<span class="op">=</span><span class="dv">4326</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    borders<span class="op">=</span><span class="st">"DEPARTEMENT"</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    vectorfile_format<span class="op">=</span><span class="st">"geojson"</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>    filter_by<span class="op">=</span><span class="st">"FRANCE_ENTIERE_DROM_RAPPROCHES"</span>,</span>
<span id="cb4-9"><a href="#cb4-9"></a>    source<span class="op">=</span><span class="st">"EXPRESS-COG-CARTO-TERRITOIRE"</span>,</span>
<span id="cb4-10"><a href="#cb4-10"></a>    year<span class="op">=</span><span class="dv">2022</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</figure>
</div>
<p><code>departements</code> est un <code>GeoDataFrame</code> classique proposant les m√©tadonn√©es usuelles de <code>cartiflette</code> avec des g√©ographies modifi√©es pour rapprocher la France des DROM<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div id="d09a1099" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>departements.boundary.plot(edgecolor <span class="op">=</span> <span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="usecase2_files/figure-html/cell-6-output-1.png" width="432" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="association-du-fonds-de-carte-cartiflette-au-jeu-de-donn√©es-initial" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="association-du-fonds-de-carte-cartiflette-au-jeu-de-donn√©es-initial"><span class="header-section-number">2.2</span> Association du fonds de carte <code>cartiflette</code> au jeu de donn√©es initial</h2>
<p>La suite du travail n‚Äôest pas intrins√®quement li√© √† <code>cartiflette</code> mais correspond √† de la manipulation de donn√©es spatiales n√©cessaires √† la finalisation de la carte.</p>
<p>Comme nous avons besoin de localiser les d√©comptes d√©partements de b√©tail, nous faisons une jointure spatiale entre notre fonds de carte et nos cheptels</p>
<div id="3135f472" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cheptel_geospatial <span class="op">=</span> departements.merge(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    cheptel[<span class="dv">0</span>], left_on<span class="op">=</span><span class="st">"INSEE_DEP"</span>, right_on <span class="op">=</span> <span class="st">"code"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A partir de l√†, on finalise notre travail sur le jeu de donn√©es pour calculer le ratio entre le nombre de t√™tes et la population:</p>
<div id="d7a0ca8c" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>D√©rouler pour voir la finalisation du travail de donn√©es</summary>
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ratio_cheptel(type_cheptel, data_departement):</span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Fonction permettant de rapporter, pour un type de b√™te donn√©,</span></span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    le nombre de t√™tes par habitant d'un d√©partement </span></span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6" aria-hidden="true" tabindex="-1"></a>    data_departement <span class="op">=</span> data_departement.copy()</span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7" aria-hidden="true" tabindex="-1"></a>    data_departement[<span class="st">"ratio_"</span> <span class="op">+</span> type_cheptel] <span class="op">=</span> (</span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8" aria-hidden="true" tabindex="-1"></a>        data_departement.loc[:, type_cheptel]</span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9" aria-hidden="true" tabindex="-1"></a>        .div(data_departement[<span class="st">"POPULATION"</span>], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11" aria-hidden="true" tabindex="-1"></a>    data_departement[<span class="st">"more_"</span> <span class="op">+</span> type_cheptel] <span class="op">=</span> (</span>
<span id="annotated-cell-7-12"><a href="#annotated-cell-7-12" aria-hidden="true" tabindex="-1"></a>        data_departement[<span class="st">"ratio_"</span> <span class="op">+</span> type_cheptel] <span class="op">&gt;</span> <span class="dv">1</span></span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-7-14"><a href="#annotated-cell-7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_departement.loc[:, <span class="st">"more_"</span> <span class="op">+</span> type_cheptel]</span>
<span id="annotated-cell-7-15"><a href="#annotated-cell-7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16" aria-hidden="true" tabindex="-1"></a>eval_ratio <span class="op">=</span> pd.concat(</span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17" aria-hidden="true" tabindex="-1"></a>    [ratio_cheptel(bete, cheptel_geospatial) <span class="cf">for</span> bete <span class="kw">in</span> cheptel[<span class="dv">1</span>]],</span>
<span id="annotated-cell-7-18"><a href="#annotated-cell-7-18" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="dv">1</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-19" class="code-annotation-target"><a href="#annotated-cell-7-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-7-20"><a href="#annotated-cell-7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-21"><a href="#annotated-cell-7-21" aria-hidden="true" tabindex="-1"></a>cheptel_geospatial <span class="op">=</span> pd.concat(</span>
<span id="annotated-cell-7-22"><a href="#annotated-cell-7-22" aria-hidden="true" tabindex="-1"></a>    [cheptel_geospatial, eval_ratio],</span>
<span id="annotated-cell-7-23"><a href="#annotated-cell-7-23" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="dv">1</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-24" class="code-annotation-target"><a href="#annotated-cell-7-24" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="19" data-code-annotation="1">Un <em>DataFrame</em> temporaire permettant de d√©finir, par le biais d‚Äôune boucle, nos indicateurs de population.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="24" data-code-annotation="2">On associe ces nouvelles colonnes √† nos donn√©es initiales</span>
</dd>
</dl>
</div>
</div>
<p>Le jeu de donn√©es pr√™t √† l‚Äôemploi prend la forme suivante:</p>
<div id="4883e04b" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>cheptel_geospatial.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE_DEP</th>
<th data-quarto-table-cell-role="th">PAYS</th>
<th data-quarto-table-cell-role="th">LIBELLE_DEPARTEMENT</th>
<th data-quarto-table-cell-role="th">POPULATION</th>
<th data-quarto-table-cell-role="th">SOURCE</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">departement</th>
<th data-quarto-table-cell-role="th">Bovins</th>
<th data-quarto-table-cell-role="th">Porcins</th>
<th data-quarto-table-cell-role="th">Ovins</th>
<th data-quarto-table-cell-role="th">Caprins</th>
<th data-quarto-table-cell-role="th">Volailles</th>
<th data-quarto-table-cell-role="th">more_Bovins</th>
<th data-quarto-table-cell-role="th">more_Porcins</th>
<th data-quarto-table-cell-role="th">more_Ovins</th>
<th data-quarto-table-cell-role="th">more_Caprins</th>
<th data-quarto-table-cell-role="th">more_Volailles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>43</td>
<td>France</td>
<td>Haute-Loire</td>
<td>227570</td>
<td>IGN:EXPRESS-COG-CARTO-TERRITOIRE</td>
<td>POLYGON ((3.89745 45.35699, 3.89731 45.35658, ...</td>
<td>43</td>
<td>Haute-Loire</td>
<td>209400.0</td>
<td>61000.0</td>
<td>146500.0</td>
<td>14800.0</td>
<td>NaN</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>65</td>
<td>France</td>
<td>Hautes-Pyr√©n√©es</td>
<td>229567</td>
<td>IGN:EXPRESS-COG-CARTO-TERRITOIRE</td>
<td>MULTIPOLYGON (((-0.09705 43.5822, -0.09642 43....</td>
<td>65</td>
<td>Hautes-Pyr√©n√©es</td>
<td>99200.0</td>
<td>44400.0</td>
<td>128800.0</td>
<td>5300.0</td>
<td>NaN</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="production-de-la-carte-interactive" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="production-de-la-carte-interactive"><span class="header-section-number">2.3</span> Production de la carte interactive</h2>
<p>On peut maintenant se concentrer sur la carte. Pour la rendre plus informative, il est utile de contextualiser les d√©partements en permettant aux spectateurs de la carte de conna√Ætre le nom des d√©partements ayant un cheptel plus important que sa population.</p>
<p>Cela peut √™tre fait comme sur la carte d‚Äôorigine de Jules Grandin en inscrivant les noms des d√©partements concern√©s sur celle-ci. Cela n√©cessite tout de m√™me un travail manuel important pour qui n‚Äôutilise pas une interface comme QGIS.</p>
<p>Il est plus simple, pour les utilisateurs de logiciels comme <code>Python</code>, <code>R</code> ou <code>Javascript</code> de produire une carte interactive qui permet d‚Äôafficher des valeurs lorsqu‚Äôon passe la souris dessus. Il existe plusieurs √©cosyst√®mes pour faire cela, plus ou moins directement reli√©s √† <code>Javascript</code>, le langage consacr√© pour ce type d‚Äôapplications r√©actives.</p>
<p>Les exemples ci-dessous proposent un code en <code>Python</code> pour faire une carte interactive par le biais de la librairie <code>Folium</code>. Cette mani√®re de proc√©der √©tant un peu fastidieuse, car <code>Folium</code> n‚Äôest pas initialement con√ßu pour ce type de cartes, il est recommand√© de privil√©gier la solution <code>Observable</code> qui est un <em>framework</em> <code>Javascript</code> ressemblant beaucoup √† <code>Python</code> mais plus adapt√© que ce dernier pour la <em>dataviz</em>.</p>
<p>En premier lieu, on d√©finit une fonction g√©n√©rique qui permet de construire, pour un type de cheptel donn√©, la carte qui sera cr√©√©e:</p>
<div id="c4adeebd" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>D√©finition d‚Äôune fonction g√©n√©rique pour cr√©er la carte</summary>
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="annotated-cell-9-2"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> branca</span>
<span id="annotated-cell-9-3"><a href="#annotated-cell-9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-4"><a href="#annotated-cell-9-4" aria-hidden="true" tabindex="-1"></a>palettes <span class="op">=</span> {</span>
<span id="annotated-cell-9-5"><a href="#annotated-cell-9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bovins"</span>: {<span class="va">True</span>: <span class="st">"#f9b439"</span>, <span class="va">False</span>: <span class="st">"#d8d4d3"</span>},</span>
<span id="annotated-cell-9-6"><a href="#annotated-cell-9-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Porcins"</span>: {<span class="va">True</span>: <span class="st">"#ec6569"</span>, <span class="va">False</span>: <span class="st">"#d8d4d3"</span>},</span>
<span id="annotated-cell-9-7"><a href="#annotated-cell-9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ovins"</span>: {<span class="va">True</span>: <span class="st">"#5eb04e"</span>, <span class="va">False</span>: <span class="st">"#d8d4d3"</span>},</span>
<span id="annotated-cell-9-8"><a href="#annotated-cell-9-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Caprins"</span>: {<span class="va">True</span>: <span class="st">"#5eb04e"</span>, <span class="va">False</span>: <span class="st">"#d8d4d3"</span>}</span>
<span id="annotated-cell-9-9"><a href="#annotated-cell-9-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-9-10"><a href="#annotated-cell-9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-11"><a href="#annotated-cell-9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to apply color based on the 'more_XXXXX' values</span></span>
<span id="annotated-cell-9-12"><a href="#annotated-cell-9-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> style_function(feature, bete):</span>
<span id="annotated-cell-9-13"><a href="#annotated-cell-9-13" aria-hidden="true" tabindex="-1"></a>    more_bovins <span class="op">=</span> feature[<span class="st">'properties'</span>][<span class="ss">f'more_</span><span class="sc">{</span>bete<span class="sc">}</span><span class="ss">'</span>]</span>
<span id="annotated-cell-9-14"><a href="#annotated-cell-9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="annotated-cell-9-15"><a href="#annotated-cell-9-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'fillColor'</span>: palettes[bete][more_bovins],</span>
<span id="annotated-cell-9-16"><a href="#annotated-cell-9-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: <span class="st">'black'</span>,</span>
<span id="annotated-cell-9-17"><a href="#annotated-cell-9-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'weight'</span>: <span class="dv">1</span>,</span>
<span id="annotated-cell-9-18"><a href="#annotated-cell-9-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'fillOpacity'</span>: <span class="fl">0.7</span>,</span>
<span id="annotated-cell-9-19"><a href="#annotated-cell-9-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="annotated-cell-9-20"><a href="#annotated-cell-9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-21"><a href="#annotated-cell-9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-22"><a href="#annotated-cell-9-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_repartition(cheptel_geospatial, bete):</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1">1</button><span id="annotated-cell-9-23" class="code-annotation-target"><a href="#annotated-cell-9-23" aria-hidden="true" tabindex="-1"></a>    white_tile <span class="op">=</span> branca.utilities.image_to_url([[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">1</span>]])</span>
<span id="annotated-cell-9-24"><a href="#annotated-cell-9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-25"><a href="#annotated-cell-9-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize a folium map</span></span>
<span id="annotated-cell-9-26"><a href="#annotated-cell-9-26" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> folium.Map(</span>
<span id="annotated-cell-9-27"><a href="#annotated-cell-9-27" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[</span>
<span id="annotated-cell-9-28"><a href="#annotated-cell-9-28" aria-hidden="true" tabindex="-1"></a>            cheptel_geospatial.geometry.centroid.y.mean(), cheptel_geospatial.geometry.centroid.x.mean()</span>
<span id="annotated-cell-9-29"><a href="#annotated-cell-9-29" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="annotated-cell-9-30"><a href="#annotated-cell-9-30" aria-hidden="true" tabindex="-1"></a>        zoom_start<span class="op">=</span><span class="dv">5</span>,</span>
<span id="annotated-cell-9-31"><a href="#annotated-cell-9-31" aria-hidden="true" tabindex="-1"></a>        tiles<span class="op">=</span>white_tile, attr<span class="op">=</span><span class="st">"white tile"</span></span>
<span id="annotated-cell-9-32"><a href="#annotated-cell-9-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-9-33"><a href="#annotated-cell-9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-34"><a href="#annotated-cell-9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-35"><a href="#annotated-cell-9-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add GeoJson layer to the map</span></span>
<span id="annotated-cell-9-36"><a href="#annotated-cell-9-36" aria-hidden="true" tabindex="-1"></a>    folium.GeoJson(</span>
<span id="annotated-cell-9-37"><a href="#annotated-cell-9-37" aria-hidden="true" tabindex="-1"></a>        cheptel_geospatial,</span>
<span id="annotated-cell-9-38"><a href="#annotated-cell-9-38" aria-hidden="true" tabindex="-1"></a>        style_function<span class="op">=</span><span class="kw">lambda</span> x: style_function(x, bete),</span>
<span id="annotated-cell-9-39"><a href="#annotated-cell-9-39" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">=</span>folium.GeoJsonTooltip(</span>
<span id="annotated-cell-9-40"><a href="#annotated-cell-9-40" aria-hidden="true" tabindex="-1"></a>            fields<span class="op">=</span>[<span class="st">'LIBELLE_DEPARTEMENT'</span>, <span class="st">'POPULATION'</span>, bete],</span>
<span id="annotated-cell-9-41"><a href="#annotated-cell-9-41" aria-hidden="true" tabindex="-1"></a>            aliases<span class="op">=</span>[<span class="st">'Department:'</span>, <span class="st">'Population:'</span>, <span class="ss">f'</span><span class="sc">{</span>bete<span class="sc">}</span><span class="ss">:'</span>],</span>
<span id="annotated-cell-9-42"><a href="#annotated-cell-9-42" aria-hidden="true" tabindex="-1"></a>            localize<span class="op">=</span><span class="va">True</span></span>
<span id="annotated-cell-9-43"><a href="#annotated-cell-9-43" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="annotated-cell-9-44"><a href="#annotated-cell-9-44" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="annotated-cell-9-45"><a href="#annotated-cell-9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-46"><a href="#annotated-cell-9-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> m</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="23" data-code-annotation="1"><code>Folium</code> est une librairie qui est pens√©e, avant tout, pour proposer un fonds de carte type <code>OpenStreetMap</code> en arri√®re-plan. Celui-ci ne nous int√©resse pas ici car nous avons cr√©√© des √©l√©ments sans contrepartie sur la Terre (les DROM sous la France, le zoom de l‚ÄôIle de France au nord ouest de la Normandie). Nous cr√©ons donc un fond blanc qui est utilis√© de mani√®re d√©tourn√©e par Folium.</span>
</dd>
</dl>
</div>
</div>
<p>Pour cr√©er celles-ci, il suffit d√®s lors d‚Äôappliquer la fonction sur le type d‚Äô√©levage d√©sir√©:</p>
<div id="408f8d80" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Visualiser par le biais de Folium</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>map_repartition(cheptel_geospatial, <span class="st">"Bovins"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>map_repartition(cheptel_geospatial, <span class="st">"Porcins"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>map_repartition(cheptel_geospatial, <span class="st">"Ovins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>N√©anmoins, ce n‚Äôest pas la m√©thode adopt√©e pour cr√©er les cartes ci-dessous:</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="301" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 300;"><span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>carte_interactive_js2<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<p>Pour cela, il vaut mieux utiliser <code>Javascript</code> par le biais d‚Äô<code>Observable</code> dont le code est disponible dans la boite d√©roulable ci-dessous:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Comment faire avec <code>Javascript</code> ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Ce tutoriel utilise le <em>framework</em> <code>Observable</code> par le biais de <code>Quarto</code>, l‚Äôoutil de construction de site web d√©velopp√© par <code>Posit</code>. Le code source de cette page est disponible <a href="https://github.com/InseeFrLab/cartiflette-website/blob/master/use-case/usecase2.qmd">ici</a><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>Pour se simplifier la t√¢che, on va cr√©er une fonction graphique qui prend en <em>input</em> un <code>Array</code> et un type d‚Äô√©levage (par exemple <em>‚ÄúBovins‚Äù</em>) et renvoie une carte:</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="318" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 317;"><span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {addTooltips} <span class="im">from</span> <span class="st">"@mkfreeman/plot-tooltip"</span></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">produceMap</span>(cheptel<span class="op">,</span> bete){</span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> carte <span class="op">=</span> <span class="fu">addTooltips</span>(</span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">plot</span>({ </span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>            <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a>            <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a>            <span class="dt">width</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a>            <span class="dt">height</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span>  </span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a>            <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a>            <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a>            <span class="dt">value</span><span class="op">:</span> [</span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a>                labels_widgets<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">==</span> bete)[<span class="dv">0</span>]<span class="op">.</span><span class="at">true</span><span class="op">,</span></span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a>                labels_widgets<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">==</span> bete)[<span class="dv">0</span>]<span class="op">.</span><span class="at">false</span>        </span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a>            <span class="dt">range</span><span class="op">:</span> [</span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a>                palettes<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span> <span class="op">==</span> bete)[<span class="dv">0</span>]<span class="op">.</span><span class="at">trueColor</span><span class="op">,</span></span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a>                palettes<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span> <span class="op">==</span> bete)[<span class="dv">0</span>]<span class="op">.</span><span class="at">falseColor</span></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a>            ]<span class="op">,</span></span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> <span class="st">"Alors ?"</span></span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> {<span class="dt">axis</span><span class="op">:</span> <span class="kw">null</span>}<span class="op">,</span></span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> {<span class="dt">axis</span><span class="op">:</span> <span class="kw">null</span>}<span class="op">,</span></span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a>            <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">geo</span>(cheptel<span class="op">,</span> {</span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> labels_widgets<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">==</span> bete)[<span class="dv">0</span>][d<span class="op">.</span><span class="at">properties</span>[bete] <span class="op">&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">POPULATION</span>]<span class="op">,</span></span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a>                <span class="dt">sort</span><span class="op">:</span> {</span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a>                <span class="dt">color</span><span class="op">:</span> <span class="st">"fill"</span><span class="op">,</span></span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a>                <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">LIBELLE_DEPARTEMENT</span><span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">INSEE_DEP</span><span class="sc">}</span><span class="vs">) </span><span class="sc">\n</span><span class="vs">Cheptel: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">properties</span>[bete]<span class="sc">}</span><span class="vs"> </span><span class="sc">\n</span><span class="vs">Population: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">POPULATION</span><span class="sc">}</span><span class="vs">  </span><span class="sc">\n</span><span class="vs"> Ratio: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">properties</span>[bete]<span class="op">/</span>d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">POPULATION</span>)<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="kw">undefined</span><span class="op">,</span> {<span class="dt">maximumSignificantDigits</span><span class="op">:</span> <span class="dv">2</span>})<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> carte</span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>Celle-ci utilise un certain nombre d‚Äôingr√©dients. En premier lieu, des <em>arrays</em> permettant de changer les valeurs affich√©es en fonction de la valeur du <em>widget</em> s√©lectionn√© :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" data-startfrom="360" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 359;"><span id="cb11-360"><a href="#cb11-360" aria-hidden="true" tabindex="-1"></a>labels_widgets <span class="op">=</span> [</span>
<span id="cb11-361"><a href="#cb11-361" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Bovins"</span><span class="op">,</span> <span class="dt">true</span><span class="op">:</span> <span class="st">"Plus de vaches üêÆ"</span><span class="op">,</span> <span class="dt">false</span><span class="op">:</span> <span class="st">"Plus d'habitants"</span>}<span class="op">,</span></span>
<span id="cb11-362"><a href="#cb11-362" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Porcins"</span><span class="op">,</span> <span class="dt">true</span><span class="op">:</span> <span class="st">"Plus de cochons üê∑"</span><span class="op">,</span> <span class="dt">false</span><span class="op">:</span> <span class="st">"Plus d'habitants"</span>}<span class="op">,</span></span>
<span id="cb11-363"><a href="#cb11-363" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Ovins"</span><span class="op">,</span> <span class="dt">true</span><span class="op">:</span> <span class="st">"Plus de moutons üêë"</span><span class="op">,</span> <span class="dt">false</span><span class="op">:</span> <span class="st">"Plus d'habitants"</span>}<span class="op">,</span></span>
<span id="cb11-364"><a href="#cb11-364" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Caprins"</span><span class="op">,</span> <span class="dt">true</span><span class="op">:</span> <span class="st">"Plus de ch√®vres üêê"</span><span class="op">,</span> <span class="dt">false</span><span class="op">:</span> <span class="st">"Plus d'habitants"</span>}</span>
<span id="cb11-365"><a href="#cb11-365" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-366"><a href="#cb11-366" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> [</span>
<span id="cb11-367"><a href="#cb11-367" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Bovins"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">"Plus de vaches üêÆ ou d'habitants ?"</span>}<span class="op">,</span></span>
<span id="cb11-368"><a href="#cb11-368" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Porcins"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">"Plus de cochons üê∑ ou d'habitants ?"</span>}<span class="op">,</span></span>
<span id="cb11-369"><a href="#cb11-369" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Ovins"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">"Plus de moutons üêë ou d'habitants ?"</span>}<span class="op">,</span></span>
<span id="cb11-370"><a href="#cb11-370" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">type</span><span class="op">:</span> <span class="st">"Caprins"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">"Plus de ch√®vres üêê ou d'habitants ?"</span>}</span>
<span id="cb11-371"><a href="#cb11-371" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-372"><a href="#cb11-372" aria-hidden="true" tabindex="-1"></a>palettes <span class="op">=</span> [</span>
<span id="cb11-373"><a href="#cb11-373" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-374"><a href="#cb11-374" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"Bovins"</span><span class="op">,</span></span>
<span id="cb11-375"><a href="#cb11-375" aria-hidden="true" tabindex="-1"></a>        <span class="dt">trueColor</span><span class="op">:</span> <span class="st">"#f9b439"</span><span class="op">,</span></span>
<span id="cb11-376"><a href="#cb11-376" aria-hidden="true" tabindex="-1"></a>        <span class="dt">falseColor</span><span class="op">:</span> <span class="st">"#d8d4d3"</span></span>
<span id="cb11-377"><a href="#cb11-377" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb11-378"><a href="#cb11-378" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-379"><a href="#cb11-379" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"Porcins"</span><span class="op">,</span></span>
<span id="cb11-380"><a href="#cb11-380" aria-hidden="true" tabindex="-1"></a>        <span class="dt">trueColor</span><span class="op">:</span> <span class="st">"#ec6569"</span><span class="op">,</span></span>
<span id="cb11-381"><a href="#cb11-381" aria-hidden="true" tabindex="-1"></a>        <span class="dt">falseColor</span><span class="op">:</span> <span class="st">"#d8d4d3"</span></span>
<span id="cb11-382"><a href="#cb11-382" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb11-383"><a href="#cb11-383" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-384"><a href="#cb11-384" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"Ovins"</span><span class="op">,</span></span>
<span id="cb11-385"><a href="#cb11-385" aria-hidden="true" tabindex="-1"></a>        <span class="dt">trueColor</span><span class="op">:</span> <span class="st">"#5eb04e"</span><span class="op">,</span></span>
<span id="cb11-386"><a href="#cb11-386" aria-hidden="true" tabindex="-1"></a>        <span class="dt">falseColor</span><span class="op">:</span> <span class="st">"#d8d4d3"</span></span>
<span id="cb11-387"><a href="#cb11-387" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb11-388"><a href="#cb11-388" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-389"><a href="#cb11-389" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"Caprins"</span><span class="op">,</span></span>
<span id="cb11-390"><a href="#cb11-390" aria-hidden="true" tabindex="-1"></a>        <span class="dt">trueColor</span><span class="op">:</span> <span class="st">"#00b5ed"</span><span class="op">,</span></span>
<span id="cb11-391"><a href="#cb11-391" aria-hidden="true" tabindex="-1"></a>        <span class="dt">falseColor</span><span class="op">:</span> <span class="st">"#d8d4d3"</span></span>
<span id="cb11-392"><a href="#cb11-392" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-393"><a href="#cb11-393" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-394"><a href="#cb11-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-395"><a href="#cb11-395" aria-hidden="true" tabindex="-1"></a>title_chosen <span class="op">=</span> title<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">==</span> bete)[<span class="dv">0</span>]<span class="op">.</span><span class="at">title</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="400" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 399;"><span id="cb12-400"><a href="#cb12-400" aria-hidden="true" tabindex="-1"></a>carte_interactive_js2 <span class="op">=</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb12-401"><a href="#cb12-401" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div class="bouton-cheptel"&gt;</span><span class="sc">${</span>viewof bete<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb12-402"><a href="#cb12-402" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div class="titre-carte-cheptel"&gt;&lt;h3&gt;</span><span class="sc">${</span>title_chosen<span class="sc">}</span><span class="vs">&lt;/h3&gt;&lt;/div&gt;</span></span>
<span id="cb12-403"><a href="#cb12-403" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div class="carte-cheptel"&gt;</span><span class="sc">${</span><span class="fu">produceMap</span>(cheptel<span class="op">,</span> bete)<span class="sc">}</span><span class="vs">&lt;div&gt;</span></span>
<span id="cb12-404"><a href="#cb12-404" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<p>Ce <em>widget</em> est un <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/input/radio">radio button</a> qui peut √™tre cr√©√© par le code suivant, permettant √† la fois d‚Äôexposer celui-ci sur l‚Äôinterface et de stocker sa valeur active dans la variable <code>bete</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" data-startfrom="410" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 409;"><span id="cb13-410"><a href="#cb13-410" aria-hidden="true" tabindex="-1"></a>viewof bete <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(</span>
<span id="cb13-411"><a href="#cb13-411" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">Map</span>([[<span class="st">"Vaches üêÆ"</span><span class="op">,</span> <span class="st">"Bovins"</span>]<span class="op">,</span> [<span class="st">"Cochons üê∑"</span><span class="op">,</span> <span class="st">"Porcins"</span>]<span class="op">,</span> [<span class="st">"Moutons üêë"</span><span class="op">,</span> <span class="st">"Ovins"</span>]])<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">"Bovins"</span>}</span>
<span id="cb13-412"><a href="#cb13-412" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<p>Il ne manque qu‚Äô√† importer les donn√©es n√©cessaires √† la carte dans <code>Javascript</code>. La fonction <a href="https://quarto.org/docs/interactive/ojs/data-sources.html"><code>ojs_define</code></a> permettant la transmission d‚Äôun objet <code>Python</code> √† <code>R</code> ne fonctionnant pas pour un <code>GeoPandas</code>, le plus simple est de cr√©er un GeoJSON en <code>Python</code> :</p>
<div id="e1d4cb9d" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cheptel_geospatial.to_file(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cheptel.json"</span>, driver<span class="op">=</span><span class="st">"GeoJSON"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il suffit ensuite d‚Äôimporter celui-ci avec la fonction <a href="https://quarto.org/docs/interactive/ojs/data-sources.html"><code>FileAttachment</code></a> d‚Äô<code>Observable</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-startfrom="426" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 425;"><span id="cb15-426"><a href="#cb15-426" aria-hidden="true" tabindex="-1"></a>cheptel <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"cheptel.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="comment-faire-sans-cartiflette" class="level1 sans-cartiflette" data-number="3">
<h1 class="sans-cartiflette" data-number="3"><span class="header-section-number">3</span> Comment faire sans <code>cartiflette</code> ?</h1>
<p>L‚Äôapproche est nettement plus fastidieuse sans <code>cartiflette</code> et n√©cessite une expertise assez avanc√©e en g√©omatique pour manipuler les g√©om√©tries des objets <code>Python</code>.</p>
<p>Pour obtenir les m√™mes donn√©es, pr√™tes √† l‚Äôemploi, cela passe par cinq √©tapes principales:</p>
<ul>
<li>1Ô∏è‚É£ T√©l√©charger les donn√©es et les enregistrer sur le disque, en local.</li>
<li>2Ô∏è‚É£ D√©zipper la version t√©l√©charg√©e (le format est une archive 7z) et enregistrer l‚Äôarborescence obtenue sur le disque.</li>
<li>3Ô∏è‚É£ Importer le bon <em>shapefile</em> dans <code>Python</code> et d√©couper celui-ci en diff√©rents espaces qui seront reprojet√©s</li>
<li>4Ô∏è‚É£ Pour chaque DROM et d√©partement de l‚Äô√éle de France, modifier la g√©om√©trie en jouant sur des translations et rotations</li>
<li>5Ô∏è‚É£ Consolider le fond de carte √† partir des diff√©rents √©l√©ments obtenus</li>
</ul>
<p>La premi√®re √©tape consiste donc √† t√©l√©charger le fichier depuis le site de mise √† disposition de l‚ÄôIGN. L‚Äôarchive √©tant assez volumineuse, le code propos√© propose une barre de progr√®s pour s‚Äôassurer que le t√©l√©chargement progresse.</p>
<p>Le code √©tant assez long, il n‚Äôest pas apparent par d√©faut mais il suffit de cliquer ci-dessous:</p>
<div id="lst-example-download-adminexpress" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-download-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;2: 1Ô∏è‚É£ Code pour t√©l√©charger les donn√©es
</figcaption>
<div aria-describedby="lst-example-download-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="413b5c82" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>1Ô∏è‚É£ Code pour t√©l√©charger les donn√©es</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="im">import</span> os</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="im">import</span> requests</span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="im">import</span> py7zr</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co"># Step 1: Download the file with progress bar</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>url <span class="op">=</span> <span class="st">"https://data.geopf.fr/telechargement/download/ADMIN-EXPRESS-COG-CARTO/ADMIN-EXPRESS-COG-CARTO_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG-CARTO_3-1__SHP_WGS84G_FRA_2022-04-15.7z"</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>file_name <span class="op">=</span> url.split(<span class="st">"/"</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb16-9"><a href="#cb16-9"></a></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="kw">def</span> download_7z_archive(file_name):</span>
<span id="cb16-11"><a href="#cb16-11"></a>    <span class="cf">if</span> os.path.exists(file_name) <span class="kw">is</span> <span class="va">False</span>:</span>
<span id="cb16-12"><a href="#cb16-12"></a>        <span class="co"># Streaming download with progress bar</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>        <span class="bu">print</span>(<span class="st">"Downloading file..."</span>)</span>
<span id="cb16-14"><a href="#cb16-14"></a>        response <span class="op">=</span> requests.get(url, stream<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-15"><a href="#cb16-15"></a>        total_size <span class="op">=</span> <span class="bu">int</span>(response.headers.get(<span class="st">'content-length'</span>, <span class="dv">0</span>))</span>
<span id="cb16-16"><a href="#cb16-16"></a></span>
<span id="cb16-17"><a href="#cb16-17"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_name, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>, tqdm(</span>
<span id="cb16-18"><a href="#cb16-18"></a>                desc<span class="op">=</span>file_name,</span>
<span id="cb16-19"><a href="#cb16-19"></a>                total<span class="op">=</span>total_size,</span>
<span id="cb16-20"><a href="#cb16-20"></a>                unit<span class="op">=</span><span class="st">'iB'</span>,</span>
<span id="cb16-21"><a href="#cb16-21"></a>                unit_scale<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-22"><a href="#cb16-22"></a>                unit_divisor<span class="op">=</span><span class="dv">1024</span>,</span>
<span id="cb16-23"><a href="#cb16-23"></a>            ) <span class="im">as</span> bar:</span>
<span id="cb16-24"><a href="#cb16-24"></a>            <span class="cf">for</span> chunk <span class="kw">in</span> response.iter_content(chunk_size<span class="op">=</span><span class="dv">8192</span>):</span>
<span id="cb16-25"><a href="#cb16-25"></a>                size <span class="op">=</span> <span class="bu">file</span>.write(chunk)</span>
<span id="cb16-26"><a href="#cb16-26"></a>                bar.update(size)</span>
<span id="cb16-27"><a href="#cb16-27"></a></span>
<span id="cb16-28"><a href="#cb16-28"></a>        <span class="bu">print</span>(<span class="ss">f"Downloaded </span><span class="sc">{</span>file_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-29"><a href="#cb16-29"></a>        <span class="cf">return</span> file_name</span>
<span id="cb16-30"><a href="#cb16-30"></a>    <span class="cf">else</span>:</span>
<span id="cb16-31"><a href="#cb16-31"></a>        <span class="bu">print</span>(<span class="st">"File exists, please delete it before going further"</span>)</span>
<span id="cb16-32"><a href="#cb16-32"></a></span>
<span id="cb16-33"><a href="#cb16-33"></a>download_7z_archive(file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</figure>
</div>
<p>La deuxi√®me √©tape consiste √† d√©zipper la version t√©l√©charg√©e en local</p>
<div id="lst-example-unzip-adminexpress" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-unzip-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3: 2Ô∏è‚É£ D√©zipper la version t√©l√©charg√©e
</figcaption>
<div aria-describedby="lst-example-unzip-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="c4656344" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>2Ô∏è‚É£ D√©zipper la version t√©l√©charg√©e</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">def</span> extract_7z_archive(</span>
<span id="cb17-2"><a href="#cb17-2"></a>    file_name, output_dir <span class="op">=</span> <span class="st">"extracted_files"</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>):</span>
<span id="cb17-4"><a href="#cb17-4"></a>    <span class="co"># Step 2: Extract the .7z file</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>    os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a>    <span class="bu">print</span>(<span class="st">"Extracting the file..."</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a>    <span class="cf">with</span> py7zr.SevenZipFile(file_name, mode<span class="op">=</span><span class="st">'r'</span>) <span class="im">as</span> z:</span>
<span id="cb17-9"><a href="#cb17-9"></a>        z.extractall(path<span class="op">=</span>output_dir)</span>
<span id="cb17-10"><a href="#cb17-10"></a>    <span class="bu">print</span>(<span class="ss">f"Extracted to </span><span class="sc">{</span>output_dir<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-11"><a href="#cb17-11"></a>    <span class="cf">return</span> output_dir</span>
<span id="cb17-12"><a href="#cb17-12"></a></span>
<span id="cb17-13"><a href="#cb17-13"></a>extract_7z_archive(file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</figure>
</div>
<p>La troisi√®me √©tape consiste √† importer les contours administratifs dans <code>Python</code> et √† s√©parer les DROM de la France hexagonale</p>
<div id="lst-example-split-adminexpress" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-split-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4: 3Ô∏è‚É£ D√©couper les donn√©es
</figcaption>
<div aria-describedby="lst-example-split-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="9b174f37" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code Python pour d√©couper le fond de carte AdminExpress</summary>
<div class="sourceCode cell-code" id="annotated-cell-24"><pre class="sourceCode numberSource python code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-24-1"><a href="#annotated-cell-24-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="annotated-cell-24-2"><a href="#annotated-cell-24-2"></a></span>
<span id="annotated-cell-24-3"><a href="#annotated-cell-24-3"></a>path_extraction <span class="op">=</span> <span class="st">"./extracted_files/ADMIN-EXPRESS-COG-CARTO_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG-CARTO/1_DONNEES_LIVRAISON_2022-04-15/ADECOGC_3-1_SHP_WGS84G_FRA/"</span></span>
<span id="annotated-cell-24-4"><a href="#annotated-cell-24-4"></a></span>
<span id="annotated-cell-24-5"><a href="#annotated-cell-24-5"></a><span class="co"># Limites communales</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1">1</button><span id="annotated-cell-24-6" class="code-annotation-target"><a href="#annotated-cell-24-6"></a>france <span class="op">=</span> gpd.read_file(<span class="ss">f"</span><span class="sc">{</span>path_extraction<span class="sc">}</span><span class="ss">/COMMUNE.shp"</span>).to_crs(<span class="dv">2154</span>)</span>
<span id="annotated-cell-24-7"><a href="#annotated-cell-24-7"></a>hexagone <span class="op">=</span> france.loc[</span>
<span id="annotated-cell-24-8"><a href="#annotated-cell-24-8"></a>    <span class="op">~</span>france[<span class="st">"INSEE_DEP"</span>].isin([<span class="st">"971"</span>, <span class="st">"972"</span>, <span class="st">"973"</span>, <span class="st">"974"</span>, <span class="st">"976"</span>])</span>
<span id="annotated-cell-24-9"><a href="#annotated-cell-24-9"></a>]</span>
<span id="annotated-cell-24-10"><a href="#annotated-cell-24-10"></a>guadeloupe <span class="op">=</span> france.loc[france[<span class="st">"INSEE_DEP"</span>] <span class="op">==</span> <span class="st">"971"</span>]</span>
<span id="annotated-cell-24-11"><a href="#annotated-cell-24-11"></a>martinique <span class="op">=</span> france.loc[france[<span class="st">"INSEE_DEP"</span>] <span class="op">==</span> <span class="st">"972"</span>]</span>
<span id="annotated-cell-24-12"><a href="#annotated-cell-24-12"></a>guyane <span class="op">=</span> france.loc[france[<span class="st">"INSEE_DEP"</span>] <span class="op">==</span> <span class="st">"973"</span>]</span>
<span id="annotated-cell-24-13"><a href="#annotated-cell-24-13"></a>reunion <span class="op">=</span> france.loc[france[<span class="st">"INSEE_DEP"</span>] <span class="op">==</span> <span class="st">"974"</span>]</span>
<span id="annotated-cell-24-14"><a href="#annotated-cell-24-14"></a>mayotte <span class="op">=</span> france.loc[france[<span class="st">"INSEE_DEP"</span>] <span class="op">==</span> <span class="st">"976"</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="6" data-code-annotation="1">Pour les op√©rations g√©om√©triques ult√©rieures, il est n√©cessaire d‚Äôadopter le r√©f√©rentiel Lambert 93.</span>
</dd>
</dl>
</div>
</div>
</div>
</figure>
</div>
<p>La quatri√®me √©tape est celle faisant appel √† une expertise dans le domaine g√©omatique. Il est n√©cessaire de d√©placer les d√©partements d‚ÄôOutre Mer. Du point de vue g√©om√©trique, cela implique de trouver les bonnes translations et rotations. Celles-ci sont donn√©es telles quelles.</p>
<div id="lst-example-split-adminexpress-1" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-split-adminexpress-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5: 4Ô∏è‚É£ Modifier la g√©om√©trie en jouant sur des translations et rotations (Guadeloupe)
</figcaption>
<div aria-describedby="lst-example-split-adminexpress-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="873c668e" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>guadeloupe_mod <span class="op">=</span> guadeloupe.copy().to_crs(<span class="dv">5490</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>guadeloupe_mod[<span class="st">"geometry"</span>] <span class="op">=</span> (</span>
<span id="cb18-4"><a href="#cb18-4"></a>    guadeloupe_mod.scale(xfact<span class="op">=</span><span class="fl">1.32</span>, yfact<span class="op">=</span><span class="fl">1.32</span>, origin<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb18-5"><a href="#cb18-5"></a>    .translate( <span class="op">-</span><span class="dv">699983</span>, <span class="dv">4269050</span>)</span>
<span id="cb18-6"><a href="#cb18-6"></a>)</span>
<span id="cb18-7"><a href="#cb18-7"></a>guadeloupe_mod <span class="op">=</span> guadeloupe_mod.set_geometry(<span class="st">"geometry"</span>, crs<span class="op">=</span><span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</figure>
</div>
<div id="lst-example-split-adminexpress-2" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-split-adminexpress-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;6: 4Ô∏è‚É£ Modifier la g√©om√©trie en jouant sur des translations et rotations (Martinique)
</figcaption>
<div aria-describedby="lst-example-split-adminexpress-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="71f1d796" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>martinique_mod <span class="op">=</span> martinique.copy().to_crs(<span class="dv">5490</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>martinique_mod[<span class="st">"geometry"</span>] <span class="op">=</span> (</span>
<span id="cb19-4"><a href="#cb19-4"></a>    martinique_mod</span>
<span id="cb19-5"><a href="#cb19-5"></a>    .scale(</span>
<span id="cb19-6"><a href="#cb19-6"></a>        xfact<span class="op">=</span><span class="fl">1.85</span>, yfact<span class="op">=</span><span class="fl">1.85</span>, origin<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb19-7"><a href="#cb19-7"></a>    )</span>
<span id="cb19-8"><a href="#cb19-8"></a>    .translate(<span class="op">-</span><span class="dv">1134525</span>, <span class="dv">3517169</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a>)</span>
<span id="cb19-10"><a href="#cb19-10"></a>martinique_mod <span class="op">=</span> (</span>
<span id="cb19-11"><a href="#cb19-11"></a>    martinique_mod</span>
<span id="cb19-12"><a href="#cb19-12"></a>    .set_geometry(<span class="st">"geometry"</span>, crs<span class="op">=</span><span class="dv">2154</span>)</span>
<span id="cb19-13"><a href="#cb19-13"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</figure>
</div>
<div id="lst-example-split-adminexpress-3" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-split-adminexpress-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;7: 4Ô∏è‚É£ Modifier la g√©om√©trie en jouant sur des translations et rotations (Guyane)
</figcaption>
<div aria-describedby="lst-example-split-adminexpress-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="3caf28f4" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>guyane_mod <span class="op">=</span> guyane.copy().to_crs(<span class="dv">2972</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a>guyane_mod[<span class="st">"geometry"</span>] <span class="op">=</span> (</span>
<span id="cb20-3"><a href="#cb20-3"></a>    guyane_mod.scale(xfact<span class="op">=</span><span class="fl">0.25</span>, yfact<span class="op">=</span><span class="fl">0.25</span>, origin<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb20-4"><a href="#cb20-4"></a>    .translate(<span class="dv">118687</span>, <span class="dv">6286270</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a>)</span>
<span id="cb20-6"><a href="#cb20-6"></a>guyane_mod <span class="op">=</span> (</span>
<span id="cb20-7"><a href="#cb20-7"></a>    guyane_mod</span>
<span id="cb20-8"><a href="#cb20-8"></a>    .set_geometry(<span class="st">"geometry"</span>, crs<span class="op">=</span><span class="dv">2154</span>)</span>
<span id="cb20-9"><a href="#cb20-9"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</figure>
</div>
<div id="lst-example-split-adminexpress-4" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-split-adminexpress-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;8: 4Ô∏è‚É£ Modifier la g√©om√©trie en jouant sur des translations et rotations (R√©union)
</figcaption>
<div aria-describedby="lst-example-split-adminexpress-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="c07759cf" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>reunion_mod <span class="op">=</span> reunion.copy().to_crs(<span class="dv">2975</span>)</span>
<span id="cb21-2"><a href="#cb21-2"></a>reunion_mod[<span class="st">"geometry"</span>] <span class="op">=</span> (</span>
<span id="cb21-3"><a href="#cb21-3"></a>    reunion_mod.scale(xfact<span class="op">=</span><span class="fl">1.75</span>, yfact<span class="op">=</span><span class="fl">1.75</span>, origin<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb21-4"><a href="#cb21-4"></a>    .translate(<span class="op">-</span><span class="dv">422169</span>, <span class="op">-</span><span class="dv">7132230</span>)</span>
<span id="cb21-5"><a href="#cb21-5"></a>)</span>
<span id="cb21-6"><a href="#cb21-6"></a>reunion_mod <span class="op">=</span> reunion_mod.set_geometry(<span class="st">"geometry"</span>, crs<span class="op">=</span><span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</figure>
</div>
<div id="lst-example-split-adminexpress-5" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-split-adminexpress-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;9: 4Ô∏è‚É£ Modifier la g√©om√©trie en jouant sur des translations et rotations (Zoom Ile de France)
</figcaption>
<div aria-describedby="lst-example-split-adminexpress-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="3db7ab45" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>zoom <span class="op">=</span> (</span>
<span id="cb22-2"><a href="#cb22-2"></a>    france</span>
<span id="cb22-3"><a href="#cb22-3"></a>    .loc[france[<span class="st">"INSEE_DEP"</span>].isin([<span class="st">"75"</span>, <span class="st">"92"</span>, <span class="st">"93"</span>, <span class="st">"94"</span>])]</span>
<span id="cb22-4"><a href="#cb22-4"></a>    .copy()</span>
<span id="cb22-5"><a href="#cb22-5"></a>)</span>
<span id="cb22-6"><a href="#cb22-6"></a>zoom[<span class="st">"geometry"</span>] <span class="op">=</span> (</span>
<span id="cb22-7"><a href="#cb22-7"></a>    zoom.scale(xfact<span class="op">=</span><span class="fl">2.78</span>, yfact<span class="op">=</span><span class="fl">2.78</span>, origin<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb22-8"><a href="#cb22-8"></a>    .to_crs(<span class="dv">2154</span>)</span>
<span id="cb22-9"><a href="#cb22-9"></a>    .translate(<span class="op">-</span><span class="dv">1634506</span>, <span class="op">-</span><span class="dv">12046235</span>)</span>
<span id="cb22-10"><a href="#cb22-10"></a>)</span>
<span id="cb22-11"><a href="#cb22-11"></a>zoom <span class="op">=</span> zoom.set_geometry(<span class="st">"geometry"</span>, crs<span class="op">=</span><span class="dv">2154</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</figure>
</div>
<p>Enfin, la derni√®re √©tape consiste √† consolider notre fonds de carte en r√©unissant les g√©om√©tries ensemble<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. On obtient un fonds de carte √©quivalent √† celui de <code>cartiflette</code> qui pourrait √™tre utilis√© de la m√™me mani√®re que pr√©c√©demment ‚òùÔ∏è.</p>
<div id="lst-example-merge-adminexpress" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-example-merge-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;10: 4Ô∏è‚É£ R√©unir toutes les g√©om√©tries ensemble
</figcaption>
<div aria-describedby="lst-example-merge-adminexpress-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="1aa03bdf" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>france_modif <span class="op">=</span> pd.concat(</span>
<span id="cb23-2"><a href="#cb23-2"></a>    [</span>
<span id="cb23-3"><a href="#cb23-3"></a>        hexagone,</span>
<span id="cb23-4"><a href="#cb23-4"></a>        guadeloupe_mod,</span>
<span id="cb23-5"><a href="#cb23-5"></a>        martinique_mod,</span>
<span id="cb23-6"><a href="#cb23-6"></a>        guyane_mod,</span>
<span id="cb23-7"><a href="#cb23-7"></a>        reunion_mod,</span>
<span id="cb23-8"><a href="#cb23-8"></a>        guyane_mod,</span>
<span id="cb23-9"><a href="#cb23-9"></a>        zoom</span>
<span id="cb23-10"><a href="#cb23-10"></a>    ]</span>
<span id="cb23-11"><a href="#cb23-11"></a>)</span>
<span id="cb23-12"><a href="#cb23-12"></a></span>
<span id="cb23-13"><a href="#cb23-13"></a>france_modif.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="usecase2_files/figure-html/cell-22-output-1.png" width="447" height="442" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
</section>
<section id="bilan" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Bilan</h1>
<p>Si le fait qu‚Äôil suffise que le code de <code>cartiflette</code> se r√©duise √† <a href="#lst-cartiflette-example" class="quarto-xref">Listing&nbsp;1</a> contre <a href="#lst-example-download-adminexpress" class="quarto-xref">Listing&nbsp;2</a>, <a href="#lst-example-unzip-adminexpress" class="quarto-xref">Listing&nbsp;3</a>, <a href="#lst-example-split-adminexpress-1" class="quarto-xref">Listing&nbsp;5</a>, <a href="#lst-example-split-adminexpress-2" class="quarto-xref">Listing&nbsp;6</a>, <a href="#lst-example-split-adminexpress-3" class="quarto-xref">Listing&nbsp;7</a>, <a href="#lst-example-split-adminexpress-4" class="quarto-xref">Listing&nbsp;8</a>, <a href="#lst-example-split-adminexpress-5" class="quarto-xref">Listing&nbsp;9</a>,<a href="#lst-example-merge-adminexpress" class="quarto-xref">Listing&nbsp;10</a> pour obtenir un r√©sultat √©quivalent ne suffit pas, si le fait que le <em>GeoDataFrame</em> obtenu avec <code>cartiflette</code> comporte plus de m√©tadonn√©es que celui cr√©√© sans ce <em>package</em> n‚Äôest pas non plus suffisant, la suite d√©roule quelques arguments suppl√©mentaires de l‚Äôint√©r√™t d‚Äôutiliser <code>cartiflette</code>.</p>
<section id="volume-de-donn√©es-t√©l√©charg√©es" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="volume-de-donn√©es-t√©l√©charg√©es"><span class="header-section-number">4.1</span> Volume de donn√©es t√©l√©charg√©es</h2>
<div id="7787b64b" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Fonction convert_size pour avoir les tailles de fichiers dans un format lisible par un humain</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a human-readable format (e.g., MB, GB)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_size(size_bytes):</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> size_bytes <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"0B"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    size_name <span class="op">=</span> (<span class="st">"B"</span>, <span class="st">"KB"</span>, <span class="st">"MB"</span>, <span class="st">"GB"</span>, <span class="st">"TB"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="bu">int</span>(math.floor(math.log(size_bytes, <span class="dv">1024</span>)))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> math.<span class="bu">pow</span>(<span class="dv">1024</span>, i)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">round</span>(size_bytes <span class="op">/</span> p, <span class="dv">2</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>s<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>size_name[i]<span class="sc">}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="684cbb44" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Evaluation de la taille des fichiers issus d‚ÄôAdminExpress</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Path to the zipped file</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>zipped_file <span class="op">=</span> <span class="st">"ADMIN-EXPRESS-COG-CARTO_3-1__SHP_WGS84G_FRA_2022-04-15.7z"</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the size of the zipped file in bytes</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>zipped_size <span class="op">=</span> os.path.getsize(zipped_file)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Path to the directory containing unzipped files</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>unzipped_dir <span class="op">=</span> <span class="st">"./extracted_files"</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>root_directory <span class="op">=</span> Path(unzipped_dir)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>size_dir <span class="op">=</span> <span class="bu">sum</span>(f.stat().st_size <span class="cf">for</span> f <span class="kw">in</span> root_directory.glob(<span class="st">'**/*'</span>) <span class="cf">if</span> f.is_file())</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>poids_archive_compressee <span class="op">=</span> convert_size(zipped_size)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>poids_archive_decompressee <span class="op">=</span> convert_size(size_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="baa029d3" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Evaluation de la taille des m√™mes donn√©es issues de cartiflette</summary>
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a>writedir <span class="op">=</span> <span class="st">"cartiflette-data/usecase2"</span></span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a>os.makedirs(writedir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a>departements.to_file(</span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>writedir<span class="sc">}</span><span class="ss">/contours.shp"</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1">1</button><span id="annotated-cell-14-5" class="code-annotation-target"><a href="#annotated-cell-14-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-7"><a href="#annotated-cell-14-7" aria-hidden="true" tabindex="-1"></a>poids_archive_cartiflette_bytes <span class="op">=</span> os.path.getsize(<span class="ss">f"</span><span class="sc">{</span>writedir<span class="sc">}</span><span class="ss">/contours.shp"</span>)</span>
<span id="annotated-cell-14-8"><a href="#annotated-cell-14-8" aria-hidden="true" tabindex="-1"></a>poids_archive_cartiflette <span class="op">=</span> convert_size(</span>
<span id="annotated-cell-14-9"><a href="#annotated-cell-14-9" aria-hidden="true" tabindex="-1"></a>    poids_archive_cartiflette_bytes</span>
<span id="annotated-cell-14-10"><a href="#annotated-cell-14-10" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="5" data-code-annotation="1">On cr√©e un <em>shapefile</em> avec le <code>GeoDataFrame</code> obtenu depuis <code>cartiflette</code> afin d‚Äôavoir une comparaison honn√™te avec le fonds de carte issu du site de l‚ÄôIGN.</span>
</dd>
</dl>
</div>
</div>
<p>La premi√®re base de comparaison possible est la taille sur disque des fonds de carte r√©cup√©r√©s par <code>cartiflette</code> ou sans passer par ce <em>package</em>. Le code ci-dessus ‚òùÔ∏è permet de construire les statistiques suivantes:</p>
<ul>
<li>Les donn√©es <code>cartiflette</code> repr√©senteraient <strong>11.78 MB</strong> si elles √©taient stock√©es sur disque.</li>
<li>Sans passer par <code>cartiflette</code>, on a besoin de <strong>240.67 MB</strong> pour stocker les fonds de carte d√©compress√©s auxquels il faut ajouter 142.86 MB pour stocker l‚Äôarchive compress√©e.</li>
</ul>
<p>Autrement dit, les donn√©es r√©cup√©r√©es sans <code>cartiflette</code> repr√©sentent <strong>33 fois</strong> le volume de celles exclusivement n√©cessaires pour cette carte.</p>
<p>L‚Äôarborescence du dossier d√©compress√© est √©galement assez cons√©quente: nous avons 68 fichiers. L‚Äôarborescence compl√®te obtenue sans <code>cartiflette</code> est disponible ci-dessous. Avec <code>cartiflette</code> aucun fichier n‚Äôest √©crit sur disque, tout est directement accessible dans la session <code>Python</code>.</p>
<details>
<summary>
Arborescence compl√®te
</summary>
<div id="d32a7118" class="cell" data-execution_count="27">
<div class="cell-output cell-output-stdout">
<pre><code>extracted_files/
‚îî‚îÄ‚îÄ ADMIN-EXPRESS-COG-CARTO_3-1__SHP_WGS84G_FRA_2022-04-15/
    ‚îú‚îÄ‚îÄ ADMIN-EXPRESS-COG-CARTO/
    ‚îÇ   ‚îú‚îÄ‚îÄ 1_DONNEES_LIVRAISON_2022-04-15/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ADECOGC_3-1_SHP_WGS84G_FRA/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT_MUNICIPAL.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT_MUNICIPAL.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT_MUNICIPAL.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT_MUNICIPAL.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARRONDISSEMENT_MUNICIPAL.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CANTON.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CANTON.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CANTON.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CANTON.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CANTON.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_ARRONDISSEMENT_MUNICIPAL.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_ARRONDISSEMENT_MUNICIPAL.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_ARRONDISSEMENT_MUNICIPAL.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_ARRONDISSEMENT_MUNICIPAL.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_ARRONDISSEMENT_MUNICIPAL.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE_ASSOCIEE_OU_DELEGUEE.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE_ASSOCIEE_OU_DELEGUEE.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE_ASSOCIEE_OU_DELEGUEE.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE_ASSOCIEE_OU_DELEGUEE.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CHFLIEU_COMMUNE_ASSOCIEE_OU_DELEGUEE.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COLLECTIVITE_TERRITORIALE.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COLLECTIVITE_TERRITORIALE.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COLLECTIVITE_TERRITORIALE.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COLLECTIVITE_TERRITORIALE.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COLLECTIVITE_TERRITORIALE.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE_ASSOCIEE_OU_DELEGUEE.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE_ASSOCIEE_OU_DELEGUEE.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE_ASSOCIEE_OU_DELEGUEE.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE_ASSOCIEE_OU_DELEGUEE.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ COMMUNE_ASSOCIEE_OU_DELEGUEE.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DEPARTEMENT.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DEPARTEMENT.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DEPARTEMENT.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DEPARTEMENT.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DEPARTEMENT.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EPCI.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EPCI.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EPCI.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EPCI.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EPCI.shx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ REGION.cpg
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ REGION.dbf
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ REGION.prj
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ REGION.shp
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ REGION.shx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ADECOGC_3-1_SHP_WGS84G_FRA.md5
    ‚îÇ   ‚îú‚îÄ‚îÄ 1_DONNEES_LIVRAISON_2022-04-15.md5
    ‚îÇ   ‚îú‚îÄ‚îÄ 2_METADONNEES_LIVRAISON_2022-04-15/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ADECOGC_3-1_SHP_WGS84G_FRA/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IGNF_ADECOGC_3-1_SHP_WGS84G_FRA.html
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ IGNF_ADECOGC_3-1_SHP_WGS84G_FRA.xml
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ADECOGC_3-1_SHP_WGS84G_FRA.md5
    ‚îÇ   ‚îú‚îÄ‚îÄ 2_METADONNEES_LIVRAISON_2022-04-15.md5
    ‚îÇ   ‚îî‚îÄ‚îÄ LISEZ-MOI.pdf
    ‚îî‚îÄ‚îÄ ADMIN-EXPRESS-COG-CARTO.md5</code></pre>
</div>
</div>
</details>
</section>
<section id="nombre-de-lignes-de-code" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="nombre-de-lignes-de-code"><span class="header-section-number">4.2</span> Nombre de lignes de code</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb27" data-startfrom="676" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 675;"><span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`La r√©cup√©ration des donn√©es avec </span><span class="sc">\`</span><span class="vs">cartiflette</span><span class="sc">\`</span><span class="vs"> ne demande que __</span><span class="sc">${</span>nlines_cartiflette<span class="sc">}</span><span class="vs"> lignes de code__ contre __</span><span class="sc">${</span>nlines_no_cartiflette<span class="sc">}</span><span class="vs"> sans </span><span class="sc">\`</span><span class="vs">cartiflette</span><span class="sc">\`</span><span class="vs">__`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="expression">

</div>
</div>
</div>
<p>En ce qui concerne le temps de d√©veloppement de ce code, on est sur quelques secondes pour le code avec <code>cartiflette</code> en utilisant la <a href="../use-case/index.html">documentation interactive d‚Äôexemples</a> contre plusieurs dizaines de minutes pour le code sans <code>cartiflette</code>.</p>
</section>
<section id="temps-de-traitement" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="temps-de-traitement"><span class="header-section-number">4.3</span> Temps de traitement</h2>
<p>Le code <code>cartiflette</code> permet de r√©cup√©rer les √©l√©ments contextuels n√©cessaires en 12 secondes. Sans <code>cartiflette</code>, il faut 14 secondes. Sans <code>cartiflette</code>, soit un rapport de 1 √† 1 pour cette t√¢che.</p>
<!------------
Retrieve number of lines
-------------->
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb28" data-startfrom="702" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 701;"><span id="cb28-702"><a href="#cb28-702" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [</span>
<span id="cb28-703"><a href="#cb28-703" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-download-adminexpress'</span><span class="op">,</span></span>
<span id="cb28-704"><a href="#cb28-704" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-unzip-adminexpress'</span><span class="op">,</span></span>
<span id="cb28-705"><a href="#cb28-705" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-split-adminexpress-1'</span><span class="op">,</span></span>
<span id="cb28-706"><a href="#cb28-706" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-split-adminexpress-2'</span><span class="op">,</span></span>
<span id="cb28-707"><a href="#cb28-707" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-split-adminexpress-3'</span><span class="op">,</span></span>
<span id="cb28-708"><a href="#cb28-708" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-split-adminexpress-4'</span><span class="op">,</span></span>
<span id="cb28-709"><a href="#cb28-709" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-split-adminexpress-5'</span><span class="op">,</span></span>
<span id="cb28-710"><a href="#cb28-710" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-example-merge-adminexpres'</span></span>
<span id="cb28-711"><a href="#cb28-711" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb28-712"><a href="#cb28-712" aria-hidden="true" tabindex="-1"></a>labels_cartiflette <span class="op">=</span> [</span>
<span id="cb28-713"><a href="#cb28-713" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lst-cartiflette-example'</span></span>
<span id="cb28-714"><a href="#cb28-714" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb28-715"><a href="#cb28-715" aria-hidden="true" tabindex="-1"></a>nlines_no_cartiflette <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(nrows_no_cartiflette)</span>
<span id="cb28-716"><a href="#cb28-716" aria-hidden="true" tabindex="-1"></a>nlines_cartiflette <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(nrows_cartiflette)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb29" data-startfrom="1" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">extractLineNumbers</span>(label) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> selector <span class="op">=</span> <span class="vs">`[aria-describedby^="</span><span class="sc">${</span>label<span class="sc">}</span><span class="vs">"]`</span><span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> blocks <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(selector)<span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> lineNumbers <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    blocks<span class="op">.</span><span class="fu">forEach</span>(block <span class="kw">=&gt;</span> {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Search for ids matching "annotated-cell-XX-N"</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> annotatedCells <span class="op">=</span> block<span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">'[id^="annotated-cell-"]'</span>)<span class="op">;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        annotatedCells<span class="op">.</span><span class="fu">forEach</span>(cell <span class="kw">=&gt;</span> {</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> match <span class="op">=</span> cell<span class="op">.</span><span class="at">id</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/annotated-cell-</span><span class="sc">\d+</span><span class="ss">-</span><span class="sc">(\d+)</span><span class="ss">/</span>)<span class="op">;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (match) {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                lineNumbers<span class="op">.</span><span class="fu">push</span>(<span class="pp">parseInt</span>(match[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Search for ids matching "cbXX-N"</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cbCells <span class="op">=</span> block<span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">'[id^="cb"]'</span>)<span class="op">;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        cbCells<span class="op">.</span><span class="fu">forEach</span>(cell <span class="kw">=&gt;</span> {</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> match <span class="op">=</span> cell<span class="op">.</span><span class="at">id</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/cb</span><span class="sc">\d+</span><span class="ss">-</span><span class="sc">(\d+)</span><span class="ss">/</span>)<span class="op">;</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (match) {</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>                lineNumbers<span class="op">.</span><span class="fu">push</span>(<span class="pp">parseInt</span>(match[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lineNumbers<span class="op">;</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getMaxLineNumber</span>(label) {</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lineNumbers <span class="op">=</span> <span class="fu">extractLineNumbers</span>(label)<span class="op">;</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>lineNumbers)<span class="op">;</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Iterate over labels to get max line numbers</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>nrows_no_cartiflette <span class="op">=</span> labels<span class="op">.</span><span class="fu">map</span>(label <span class="kw">=&gt;</span> {</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxLineNumber <span class="op">=</span> <span class="fu">getMaxLineNumber</span>(label)<span class="op">;</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> maxLineNumber<span class="op">;</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>nrows_cartiflette <span class="op">=</span> labels_cartiflette<span class="op">.</span><span class="fu">map</span>(label <span class="kw">=&gt;</span> {</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxLineNumber <span class="op">=</span> <span class="fu">getMaxLineNumber</span>(label)<span class="op">;</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> maxLineNumber<span class="op">;</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Dans l‚Äôid√©al, nous utiliserions les <a href="https://www.insee.fr/fr/statistiques/7728787?sommaire=7728826">populations l√©gales</a> mesur√©es par l‚ÄôInsee. Les fonds de carte de l‚ÄôIGN proposent n√©anmoins d√©j√† une variable <code>POPULATION</code> qui est celle qui sera utilis√©e ici. Des travaux ult√©rieurs sur <code>cartiflette</code> viseront √† remplacer cette variable par les populations l√©gales pour assurer que les m√©tadonn√©es utilis√©es par les fonds de carte correspondent, au m√™me titre que les d√©coupages g√©om√©triques, aux donn√©es officielles.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>Ce fonds de carte est en g√©om√©trie WGS84 (CRS: 4326). Ce n‚Äôest n√©anmoins qu‚Äôune apparence car les g√©om√©tries n√©cessaires pour repr√©senter les DROM et l‚ÄôIle de France sur cette carte ne correspondent √† aucune r√©alit√© terrestre. Il ne faut donc consid√©rer ce fonds de carte que pour la cartographie finale, pas la manipulation de donn√©es g√©ographique (par exemple pour un calcul de distance terrestre). Pour celles-ci, le fonds de carte normal √† utiliser est <code>FRANCE_ENTIERE</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p><code>Javascript</code> est un langage asynchrone donc l‚Äôex√©cution du code ne d√©pend pas de l‚Äôordre de d√©finition des objets dans le code, contrairement √† <code>Python</code>. Il est donc normal de voir dans les codes ci-dessous une utilisation d‚Äôune variable, par exemple <code>bete</code>, qui n‚Äôest pas d√©finie en amont. Celle-ci peut √™tre d√©finie plus loin dans le code, c‚Äôest <code>Javascript</code> qui va r√©ordonner de mani√®re logique l‚Äôex√©cution du code.<a href="#fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn4"><p>L‚Äôemplacement des DROM produit par ce code <code>Python</code> est diff√©rent de celui du fond de carte de <code>cartiflette</code>. Ce dernier est g√©n√©r√© gr√¢ce √† <code>mapshaper</code> en s‚Äôinspirant d‚Äôun <a href="https://www.icem7.fr/cartographie/un-fond-de-carte-france-par-commune-optimise-pour-le-web-et-lanalyse-statistique/">tutoriel d‚ÄôEric Mauvi√®re</a>. Celui propos√© ici en <code>Python</code> est inspir√© d‚Äôun code <code>R</code> d‚Äôun √©minent coll√®gue de l‚ÄôInsee, Lionel Cacheux.<a href="#fnref4" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imh0bWxgPGRpdj4ke2NhcnRlX2ludGVyYWN0aXZlX2pzfTwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBiZXRldmlldyA9IElucHV0cy5iaW5kKFxuICAgIElucHV0cy5yYWRpbyhcbiAgICAgICAgbmV3IE1hcChbW1wiVmFjaGVzIPCfkK5cIiwgXCJCb3ZpbnNcIl0sIFtcIkNvY2hvbnMg8J+Qt1wiLCBcIlBvcmNpbnNcIl0sIFtcIk1vdXRvbnMg8J+QkVwiLCBcIk92aW5zXCJdXSksIHt2YWx1ZTogXCJCb3ZpbnNcIn1cbiAgICApLFxuICAgIHZpZXdvZiBiZXRlXG4pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJjYXJ0ZV9pbnRlcmFjdGl2ZV9qcyA9IGh0bWxgXG48ZGl2IGNsYXNzPVwiYm91dG9uLWNoZXB0ZWxcIj4ke3ZpZXdvZiBiZXRldmlld308L2Rpdj5cbjxkaXYgY2xhc3M9XCJ0aXRyZS1jYXJ0ZS1jaGVwdGVsXCI+PGgzPiR7dGl0bGVfY2hvc2VufTwvaDM+PC9kaXY+XG48ZGl2IGNsYXNzPVwiY2FydGUtY2hlcHRlbFwiPiR7cHJvZHVjZU1hcChjaGVwdGVsLCBiZXRlKX08ZGl2PlxuYFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaHRtbGA8ZGl2PiR7Y2FydGVfaW50ZXJhY3RpdmVfanMyfTwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7YWRkVG9vbHRpcHN9IGZyb20gXCJAbWtmcmVlbWFuL3Bsb3QtdG9vbHRpcFwiXG5cbmZ1bmN0aW9uIHByb2R1Y2VNYXAoY2hlcHRlbCwgYmV0ZSl7XG4gICAgY29uc3QgY2FydGUgPSBhZGRUb29sdGlwcyhcbiAgICAgICAgUGxvdC5wbG90KHsgXG4gICAgICAgICAgICBtYXJnaW5MZWZ0OiAwLFxuICAgICAgICAgICAgbWFyZ2luUmlnaHQ6IDAsXG4gICAgICAgICAgICB3aWR0aDogNDAwLFxuICAgICAgICAgICAgaGVpZ2h0OiA0MDAsICBcbiAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICBsZWdlbmQ6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogW1xuICAgICAgICAgICAgICAgIGxhYmVsc193aWRnZXRzLmZpbHRlcihkID0+IGQudHlwZSA9PSBiZXRlKVswXS50cnVlLFxuICAgICAgICAgICAgICAgIGxhYmVsc193aWRnZXRzLmZpbHRlcihkID0+IGQudHlwZSA9PSBiZXRlKVswXS5mYWxzZSAgICAgICAgXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgcmFuZ2U6IFtcbiAgICAgICAgICAgICAgICBwYWxldHRlcy5maWx0ZXIoZCA9PiBkLm5hbWUgPT0gYmV0ZSlbMF0udHJ1ZUNvbG9yLFxuICAgICAgICAgICAgICAgIHBhbGV0dGVzLmZpbHRlcihkID0+IGQubmFtZSA9PSBiZXRlKVswXS5mYWxzZUNvbG9yXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgbGFiZWw6IFwiQWxvcnMgP1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeToge2F4aXM6IG51bGx9LFxuICAgICAgICAgICAgeDoge2F4aXM6IG51bGx9LFxuICAgICAgICAgICAgbWFya3M6IFtcbiAgICAgICAgICAgIFBsb3QuZ2VvKGNoZXB0ZWwsIHtcbiAgICAgICAgICAgICAgICBmaWxsOiAoZCkgPT4gbGFiZWxzX3dpZGdldHMuZmlsdGVyKGQgPT4gZC50eXBlID09IGJldGUpWzBdW2QucHJvcGVydGllc1tiZXRlXSA+IGQucHJvcGVydGllcy5QT1BVTEFUSU9OXSxcbiAgICAgICAgICAgICAgICBzb3J0OiB7XG4gICAgICAgICAgICAgICAgY29sb3I6IFwiZmlsbFwiLFxuICAgICAgICAgICAgICAgIHJldmVyc2U6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRpdGxlOiAoZCkgPT4gYCR7ZC5wcm9wZXJ0aWVzLkxJQkVMTEVfREVQQVJURU1FTlR9ICgke2QucHJvcGVydGllcy5JTlNFRV9ERVB9KSBcXG5DaGVwdGVsOiAke2QucHJvcGVydGllc1tiZXRlXX0gXFxuUG9wdWxhdGlvbjogJHtkLnByb3BlcnRpZXMuUE9QVUxBVElPTn0gIFxcbiBSYXRpbzogJHsoZC5wcm9wZXJ0aWVzW2JldGVdL2QucHJvcGVydGllcy5QT1BVTEFUSU9OKS50b0xvY2FsZVN0cmluZyh1bmRlZmluZWQsIHttYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IDJ9KX1gLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSlcbiAgICApXG4gICAgcmV0dXJuIGNhcnRlXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJsYWJlbHNfd2lkZ2V0cyA9IFtcbiAgICB7dHlwZTogXCJCb3ZpbnNcIiwgdHJ1ZTogXCJQbHVzIGRlIHZhY2hlcyDwn5CuXCIsIGZhbHNlOiBcIlBsdXMgZCdoYWJpdGFudHNcIn0sXG4gICAge3R5cGU6IFwiUG9yY2luc1wiLCB0cnVlOiBcIlBsdXMgZGUgY29jaG9ucyDwn5C3XCIsIGZhbHNlOiBcIlBsdXMgZCdoYWJpdGFudHNcIn0sXG4gICAge3R5cGU6IFwiT3ZpbnNcIiwgdHJ1ZTogXCJQbHVzIGRlIG1vdXRvbnMg8J+QkVwiLCBmYWxzZTogXCJQbHVzIGQnaGFiaXRhbnRzXCJ9LFxuICAgIHt0eXBlOiBcIkNhcHJpbnNcIiwgdHJ1ZTogXCJQbHVzIGRlIGNow6h2cmVzIPCfkJBcIiwgZmFsc2U6IFwiUGx1cyBkJ2hhYml0YW50c1wifVxuXVxudGl0bGUgPSBbXG4gICAge3R5cGU6IFwiQm92aW5zXCIsIHRpdGxlOiBcIlBsdXMgZGUgdmFjaGVzIPCfkK4gb3UgZCdoYWJpdGFudHMgP1wifSxcbiAgICB7dHlwZTogXCJQb3JjaW5zXCIsIHRpdGxlOiBcIlBsdXMgZGUgY29jaG9ucyDwn5C3IG91IGQnaGFiaXRhbnRzID9cIn0sXG4gICAge3R5cGU6IFwiT3ZpbnNcIiwgdGl0bGU6IFwiUGx1cyBkZSBtb3V0b25zIPCfkJEgb3UgZCdoYWJpdGFudHMgP1wifSxcbiAgICB7dHlwZTogXCJDYXByaW5zXCIsIHRpdGxlOiBcIlBsdXMgZGUgY2jDqHZyZXMg8J+QkCBvdSBkJ2hhYml0YW50cyA/XCJ9XG5dXG5wYWxldHRlcyA9IFtcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiQm92aW5zXCIsXG4gICAgICAgIHRydWVDb2xvcjogXCIjZjliNDM5XCIsXG4gICAgICAgIGZhbHNlQ29sb3I6IFwiI2Q4ZDRkM1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiUG9yY2luc1wiLFxuICAgICAgICB0cnVlQ29sb3I6IFwiI2VjNjU2OVwiLFxuICAgICAgICBmYWxzZUNvbG9yOiBcIiNkOGQ0ZDNcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiBcIk92aW5zXCIsXG4gICAgICAgIHRydWVDb2xvcjogXCIjNWViMDRlXCIsXG4gICAgICAgIGZhbHNlQ29sb3I6IFwiI2Q4ZDRkM1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiQ2Fwcmluc1wiLFxuICAgICAgICB0cnVlQ29sb3I6IFwiIzAwYjVlZFwiLFxuICAgICAgICBmYWxzZUNvbG9yOiBcIiNkOGQ0ZDNcIlxuICAgIH1cbl1cblxudGl0bGVfY2hvc2VuID0gdGl0bGUuZmlsdGVyKGQgPT4gZC50eXBlID09IGJldGUpWzBdLnRpdGxlXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJjYXJ0ZV9pbnRlcmFjdGl2ZV9qczIgPSBodG1sYFxuPGRpdiBjbGFzcz1cImJvdXRvbi1jaGVwdGVsXCI+JHt2aWV3b2YgYmV0ZX08L2Rpdj5cbjxkaXYgY2xhc3M9XCJ0aXRyZS1jYXJ0ZS1jaGVwdGVsXCI+PGgzPiR7dGl0bGVfY2hvc2VufTwvaDM+PC9kaXY+XG48ZGl2IGNsYXNzPVwiY2FydGUtY2hlcHRlbFwiPiR7cHJvZHVjZU1hcChjaGVwdGVsLCBiZXRlKX08ZGl2PlxuYFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGJldGUgPSBJbnB1dHMucmFkaW8oXG4gICAgbmV3IE1hcChbW1wiVmFjaGVzIPCfkK5cIiwgXCJCb3ZpbnNcIl0sIFtcIkNvY2hvbnMg8J+Qt1wiLCBcIlBvcmNpbnNcIl0sIFtcIk1vdXRvbnMg8J+QkVwiLCBcIk92aW5zXCJdXSksIHt2YWx1ZTogXCJCb3ZpbnNcIn1cbilcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNoZXB0ZWwgPSBGaWxlQXR0YWNobWVudChcImNoZXB0ZWwuanNvblwiKS5qc29uKClcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGBMYSByw6ljdXDDqXJhdGlvbiBkZXMgZG9ubsOpZXMgYXZlYyBcXGBjYXJ0aWZsZXR0ZVxcYCBuZSBkZW1hbmRlIHF1ZSBfXyR7bmxpbmVzX2NhcnRpZmxldHRlfSBsaWduZXMgZGUgY29kZV9fIGNvbnRyZSBfXyR7bmxpbmVzX25vX2NhcnRpZmxldHRlfSBzYW5zIFxcYGNhcnRpZmxldHRlXFxgX19gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibGFiZWxzID0gW1xuICAgICdsc3QtZXhhbXBsZS1kb3dubG9hZC1hZG1pbmV4cHJlc3MnLFxuICAgICdsc3QtZXhhbXBsZS11bnppcC1hZG1pbmV4cHJlc3MnLFxuICAgICdsc3QtZXhhbXBsZS1zcGxpdC1hZG1pbmV4cHJlc3MtMScsXG4gICAgJ2xzdC1leGFtcGxlLXNwbGl0LWFkbWluZXhwcmVzcy0yJyxcbiAgICAnbHN0LWV4YW1wbGUtc3BsaXQtYWRtaW5leHByZXNzLTMnLFxuICAgICdsc3QtZXhhbXBsZS1zcGxpdC1hZG1pbmV4cHJlc3MtNCcsXG4gICAgJ2xzdC1leGFtcGxlLXNwbGl0LWFkbWluZXhwcmVzcy01JyxcbiAgICAnbHN0LWV4YW1wbGUtbWVyZ2UtYWRtaW5leHByZXMnXG5dXG5sYWJlbHNfY2FydGlmbGV0dGUgPSBbXG4gICAgJ2xzdC1jYXJ0aWZsZXR0ZS1leGFtcGxlJ1xuXVxubmxpbmVzX25vX2NhcnRpZmxldHRlID0gZDMuc3VtKG5yb3dzX25vX2NhcnRpZmxldHRlKVxubmxpbmVzX2NhcnRpZmxldHRlID0gZDMuc3VtKG5yb3dzX2NhcnRpZmxldHRlKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGV4dHJhY3RMaW5lTnVtYmVycyhsYWJlbCkge1xuICAgIGNvbnN0IHNlbGVjdG9yID0gYFthcmlhLWRlc2NyaWJlZGJ5Xj1cIiR7bGFiZWx9XCJdYDtcbiAgICBjb25zdCBibG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcblxuICAgIGxldCBsaW5lTnVtYmVycyA9IFtdO1xuXG4gICAgYmxvY2tzLmZvckVhY2goYmxvY2sgPT4ge1xuICAgICAgICAvLyBTZWFyY2ggZm9yIGlkcyBtYXRjaGluZyBcImFubm90YXRlZC1jZWxsLVhYLU5cIlxuICAgICAgICBjb25zdCBhbm5vdGF0ZWRDZWxscyA9IGJsb2NrLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tpZF49XCJhbm5vdGF0ZWQtY2VsbC1cIl0nKTtcbiAgICAgICAgYW5ub3RhdGVkQ2VsbHMuZm9yRWFjaChjZWxsID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gY2VsbC5pZC5tYXRjaCgvYW5ub3RhdGVkLWNlbGwtXFxkKy0oXFxkKykvKTtcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgIGxpbmVOdW1iZXJzLnB1c2gocGFyc2VJbnQobWF0Y2hbMV0sIDEwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNlYXJjaCBmb3IgaWRzIG1hdGNoaW5nIFwiY2JYWC1OXCJcbiAgICAgICAgY29uc3QgY2JDZWxscyA9IGJsb2NrLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tpZF49XCJjYlwiXScpO1xuICAgICAgICBjYkNlbGxzLmZvckVhY2goY2VsbCA9PiB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IGNlbGwuaWQubWF0Y2goL2NiXFxkKy0oXFxkKykvKTtcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgIGxpbmVOdW1iZXJzLnB1c2gocGFyc2VJbnQobWF0Y2hbMV0sIDEwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGxpbmVOdW1iZXJzO1xufVxuXG5mdW5jdGlvbiBnZXRNYXhMaW5lTnVtYmVyKGxhYmVsKSB7XG4gICAgY29uc3QgbGluZU51bWJlcnMgPSBleHRyYWN0TGluZU51bWJlcnMobGFiZWwpO1xuICAgIHJldHVybiBNYXRoLm1heCguLi5saW5lTnVtYmVycyk7XG59XG5cbi8vIEl0ZXJhdGUgb3ZlciBsYWJlbHMgdG8gZ2V0IG1heCBsaW5lIG51bWJlcnNcbm5yb3dzX25vX2NhcnRpZmxldHRlID0gbGFiZWxzLm1hcChsYWJlbCA9PiB7XG4gICAgY29uc3QgbWF4TGluZU51bWJlciA9IGdldE1heExpbmVOdW1iZXIobGFiZWwpO1xuICAgIHJldHVybiBtYXhMaW5lTnVtYmVyO1xufSlcblxubnJvd3NfY2FydGlmbGV0dGUgPSBsYWJlbHNfY2FydGlmbGV0dGUubWFwKGxhYmVsID0+IHtcbiAgICBjb25zdCBtYXhMaW5lTnVtYmVyID0gZ2V0TWF4TGluZU51bWJlcihsYWJlbCk7XG4gICAgcmV0dXJuIG1heExpbmVOdW1iZXI7XG59KVxuXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYmV0ZXZpZXcnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYmV0ZScpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../use-case";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>